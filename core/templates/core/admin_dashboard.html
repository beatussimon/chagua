{% extends 'core/base.html' %}
{% block title %}{% trans "Admin Dashboard" %}{% endblock %}
{% block content %}
    <h1 class="text-2xl font-bold mb-6">{% trans "Admin Dashboard" %}</h1>
    <div class="card">
        {% if user.is_superuser %}
            <h2 class="text-xl mb-4">{% trans "Manage Custom Admins" %}</h2>
            <form method="post" class="mb-6">
                {% csrf_token %}
                <select name="user_id" class="border p-2 rounded w-full mb-2" aria-label="Select user">
                    {% for u in users %}
                        <option value="{{ u.id }}">{{ u.username }}</option>
                    {% endfor %}
                </select>
                <textarea name="permissions" placeholder='{"users": true, "payments": false, "contracts": true, "disputes": false, "rentals": true, "reports": false}' class="border p-2 rounded w-full mb-2 h-24" aria-label="Admin permissions"></textarea>
                <button type="submit" class="button">{% trans "Update Permissions" %}</button>
            </form>
        {% endif %}
        {% if users %}
            <details class="mb-4">
                <summary class="text-xl font-semibold cursor-pointer">{% trans "Users" %}</summary>
                {% for u in users %}
                    <div class="border-b py-2">
                        <p>{{ u.username }} - {% trans "Verified" %}: {{ u.is_verified }}</p>
                        {% if u.verification_document and not u.is_verified %}
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="user_id" value="{{ u.id }}">
                                <button type="submit" name="verify_user" class="button">{% trans "Verify" %}</button>
                            </form>
                        {% endif %}
                    </div>
                {% endfor %}
            </details>
        {% endif %}
        {% if rentals %}
            <details class="mb-4">
                <summary class="text-xl font-semibold cursor-pointer">{% trans "Rentals" %}</summary>
                {% for r in rentals %}
                    <div class="border-b py-2">
                        <p>{{ r.title }} - ${{ r.price }} - {% trans "Verified" %}: {{ r.is_verified }}</p>
                        {% if not r.is_verified %}
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="rental_id" value="{{ r.id }}">
                                <button type="submit" name="verify_rental" class="button">{% trans "Verify" %}</button>
                            </form>
                        {% endif %}
                    </div>
                {% endfor %}
            </details>
        {% endif %}
        {% if payments %}
            <details class="mb-4">
                <summary class="text-xl font-semibold cursor-pointer">{% trans "Payments" %}</summary>
                {% for p in payments %}
                    <div class="border-b py-2">
                        <p>{{ p.transaction_id }} - ${{ p.amount }} {% trans "by" %} {{ p.payer }} - {{ p.status }}</p>
                        {% if p.status == 'pending' %}
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="payment_id" value="{{ p.id }}">
                                <button type="submit" name="verify_payment" class="button">{% trans "Approve" %}</button>
                            </form>
                        {% endif %}
                    </div>
                {% endfor %}
            </details>
        {% endif %}
        {% if disputes %}
            <details class="mb-4">
                <summary class="text-xl font-semibold cursor-pointer">{% trans "Disputes" %}</summary>
                {% for d in disputes %}
                    <div class="border-b py-2">
                        <p>{{ d.description }} {% trans "by" %} {{ d.raised_by }} {% trans "on" %} {{ d.contract.rental }} - {{ d.status }}</p>
                        {% if d.status == 'open' %}
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="dispute_id" value="{{ d.id }}">
                                <button type="submit" name="resolve_dispute" class="button">{% trans "Resolve" %}</button>
                            </form>
                        {% endif %}
                    </div>
                {% endfor %}
            </details>
        {% endif %}
        {% if contracts %}
            <details class="mb-4">
                <summary class="text-xl font-semibold cursor-pointer">{% trans "Contracts" %}</summary>
                {% for c in contracts %}
                    <div class="border-b py-2">
                        <p>{{ c.rental.title }} - {% trans "Tenant" %}: {{ c.tenant }} - {{ c.status }}</p>
                        <a href="{% url 'download_contract' c.id %}" class="text-blue-500">{% trans "Download" %}</a>
                    </div>
                {% endfor %}
            </details>
        {% endif %}
        {% if reports %}
            <details class="mb-4">
                <summary class="text-xl font-semibold cursor-pointer">{% trans "Reports" %}</summary>
                {% for r in reports %}
                    <div class="border-b py-2">
                        <p>{{ r.description }} {% trans "by" %} {{ r.reporter }} - {% trans "Target" %}: {{ r.target_user|default:r.target_rental }} - {% trans "Resolved" %}: {{ r.resolved }}</p>
                        {% if not r.resolved %}
                            <form method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="report_id" value="{{ r.id }}">
                                <button type="submit" name="resolve_report" class="button">{% trans "Resolve" %}</button>
                            </form>
                        {% endif %}
                    </div>
                {% endfor %}
            </details>
        {% endif %}
    </div>
{% endblock %}