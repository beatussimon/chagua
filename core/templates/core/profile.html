{% extends 'core/base.html' %}
{% block title %}{% trans "Profile" %} - {{ profile_user.username }}{% endblock %}
{% block content %}
    <h1 class="text-2xl font-bold mb-6">{% trans "Profile" %}</h1>
    <div class="card">
        <div class="flex items-center mb-4">
            {% if profile_user.profile_picture %}
                <img src="{{ profile_user.profile_picture.url }}" class="w-24 h-24 rounded-full mr-4">
            {% endif %}
            <div>
                <h2 class="text-xl font-semibold">{{ profile_user.username }} {% if profile_user.trust_badge %}<span class="badge green"></span>{% endif %}{% if profile_user.badge_color %}<span class="badge {{ profile_user.badge_color }}"></span>{% endif %}</h2>
                <p>{{ profile_user.bio }}</p>
                <p>{% trans "Type" %}: {{ profile_user.user_type }}</p>
                <p>{% trans "Verified" %}: {{ profile_user.is_verified|yesno }}</p>
                <p>{% trans "Premium" %}: {{ profile_user.is_premium|yesno }}</p>
                <p>{% trans "Earnings" %}: ${{ earnings }}</p>
                <p>{% trans "Followers" %}: {{ profile_user.followers.count }} | {% trans "Following" %}: {{ profile_user.following.count }}</p>
            </div>
        </div>
        {% if user == profile_user %}
            <form method="post" enctype="multipart/form-data" class="mb-4">
                {% csrf_token %}
                <label>{% trans "Verification Document" %}</label>
                <input type="file" name="verification_document" class="border p-2 rounded mb-4">
                <button type="submit" class="button">{% trans "Upload" %}</button>
            </form>
            <form method="post" class="mb-4">
                {% csrf_token %}
                <button type="submit" name="create_team" class="button">{% trans "Create Team" %}</button>
                <input type="text" name="team_name" placeholder="{% trans 'Team Name' %}" class="border p-2 rounded" required>
            </form>
            {% if subscription %}
                <p>{% trans "Subscription" %}: {{ subscription.plan.name }} (Ends: {{ subscription.end_date }})</p>
            {% else %}
                <a href="{% url 'subscribe' %}" class="button">{% trans "Get Premium" %}</a>
            {% endif %}
        {% endif %}
        {% if user.is_authenticated and user != profile_user %}
            <form method="post" class="inline">
                {% csrf_token %}
                <button type="submit" name="follow" class="button">{% if user in profile_user.followers.all %}{% trans "Unfollow" %}{% else %}{% trans "Follow" %}{% endif %}</button>
            </form>
        {% endif %}
        <h3 class="text-xl mt-6">{% trans "Analytics" %}</h3>
        <p>{% trans "Total Views" %}: {{ analytics.views }}</p>
        <p>{% trans "Average Rating" %}: {{ analytics.avg_rating|floatformat:1 }}</p>
        <h3 class="text-xl mt-6">{% trans "Rentals" %}</h3>
        {% for rental in rentals %}
            <div class="border-b py-2">
                <p>{{ rental.title }} - ${{ rental.price }}</p>
                {% if user == profile_user %}
                    <form method="post" class="inline">
                        {% csrf_token %}
                        <input type="hidden" name="rental_id" value="{{ rental.id }}">
                        <button type="submit" name="boost" class="button">{% trans "Boost" %}</button>
                        <button type="submit" name="feature" class="button ml-2">{% trans "Feature" %}</button>
                    </form>
                {% endif %}
            </div>
        {% endfor %}
        <h3 class="text-xl mt-6">{% trans "Service Packages" %}</h3>
        {% for package in packages %}
            <div class="border-b py-2">
                <p>{{ package.title }} - ${{ package.price }}</p>
            </div>
        {% endfor %}
        <h3 class="text-xl mt-6">{% trans "Teams" %}</h3>
        {% for team in teams %}
            <div class="border-b py-2">
                <p>{{ team.name }}</p>
                <a href="{% url 'team_manage' team.id %}" class="text-blue-500">{% trans "Manage" %}</a>
                <a href="{% url 'team_history' team.id %}" class="text-blue-500 ml-2">{% trans "History" %}</a>
            </div>
        {% endfor %}
    </div>
{% endblock %}