{% extends 'core/base.html' %}
{% block title %}{% trans "Feedback" %}{% endblock %}
{% block content %}
    <h1 class="text-2xl font-bold mb-6">{% trans "Feedback & FAQs" %}</h1>
    <div class="card">
        <h2 class="text-xl mb-4">{% trans "Reviews" %}</h2>
        {% for review in reviews %}
            <div class="border-b py-2">
                <p>{{ review.comment }}</p>
                <p class="text-sm">{% if review.is_anonymous %}{% trans "Anonymous" %}{% else %}{{ review.reviewer }}{% endif %} - {{ review.rating }}/5 - {{ review.created_at }}</p>
                {% for media in review.media.all %}
                    <img src="{{ media.file.url }}" class="w-16 h-16 object-cover inline-block mr-2" alt="Review Media">
                {% endfor %}
                <form method="post" class="inline">
                    {% csrf_token %}
                    <input type="hidden" name="review_id" value="{{ review.id }}">
                    <button type="submit" name="like_review" class="text-blue-500">{{ review.likes }} üëç</button>
                </form>
                {% if user.is_authenticated and user != review.reviewer %}
                    <button onclick="showModal('dispute-{{ review.id }}')" class="text-red-500 ml-2">{% trans "Dispute" %}</button>
                    <div id="dispute-{{ review.id }}" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                        <div class="bg-white p-4 rounded">
                            <form method="post">
                                {% csrf_token %}
                                <input type="hidden" name="review_id" value="{{ review.id }}">
                                <textarea name="reason" class="border p-2 rounded w-full" placeholder="{% trans 'Reason for dispute' %}" required></textarea>
                                <button type="submit" name="dispute_review" class="button mt-2">{% trans "Submit" %}</button>
                                <button type="button" onclick="hideModal('dispute-{{ review.id }}')" class="button bg-red-500 ml-2">{% trans "Cancel" %}</button>
                            </form>
                        </div>
                    </div>
                {% endif %}
            </div>
        {% empty %}
            <p>{% trans "No reviews yet." %}</p>
        {% endfor %}
        <h2 class="text-xl mt-6 mb-4">{% trans "FAQs" %}</h2>
        {% for faq in faqs %}
            <div class="border-b py-2">
                <p class="font-semibold">{{ faq.question }}</p>
                <p>{{ faq.answer }}</p>
                <p class="text-sm">{% trans "By" %} {{ faq.created_by }} - {{ faq.created_at }}</p>
                <form method="post" class="inline">
                    {% csrf_token %}
                    <input type="hidden" name="faq_id" value="{{ faq.id }}">
                    <button type="submit" name="like_faq" class="text-blue-500">{{ faq.likes }} üëç</button>
                </form>
            </div>
        {% empty %}
            <p>{% trans "No FAQs yet." %}</p>
        {% endfor %}
        {% if user.is_authenticated %}
            <h3 class="mt-6 text-xl">{% trans "Add FAQ" %}</h3>
            <form method="post" class="mt-2">
                {% csrf_token %}
                {{ faq_form.as_p }}
                <button type="submit" name="faq" class="button">{% trans "Submit FAQ" %}</button>
            </form>
        {% endif %}
    </div>
{% endblock %}